<!doctype html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="gaurangrshah"><meta name="description" content="Browser-based SQLite viewer for worklog knowledge persistence. Design system by @gaurangrshah."><title>Worklog Database Viewer</title><script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.1/marked.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"><style>:root{--dark-bg-primary:#0a0a12;--dark-bg-secondary:rgba(255, 255, 255, 0.02);--dark-bg-tertiary:rgba(255, 255, 255, 0.04);--dark-text-primary:#ffffff;--dark-text-secondary:rgba(255, 255, 255, 0.7);--dark-text-tertiary:rgba(255, 255, 255, 0.5);--dark-border:rgba(255, 255, 255, 0.06);--dark-border-hover:rgba(255, 255, 255, 0.12);--light-bg-primary:#f0f4f9;--light-bg-secondary:rgba(255, 255, 255, 0.6);--light-bg-tertiary:rgba(255, 255, 255, 0.4);--light-text-primary:#0f172a;--light-text-secondary:#1e293b;--light-text-tertiary:#475569;--light-border:rgba(59, 130, 246, 0.12);--light-border-hover:rgba(59, 130, 246, 0.25);--primary-blue:#3b82f6;--primary-purple:#8b5cf6;--accent-green:#10b981;--accent-orange:#f59e0b;--primary-gradient:linear-gradient(135deg, #3b82f6, #8b5cf6);--card-accent-gradient:linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3), transparent);--page-bg-dark:radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.08) 0%, transparent 50%),radial-gradient(circle at 40% 20%, rgba(245, 158, 11, 0.05) 0%, transparent 50%);--page-bg-light:radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),radial-gradient(circle at 40% 20%, rgba(245, 158, 11, 0.08) 0%, transparent 50%),linear-gradient(135deg, #e0e7ff 0%, #dbeafe 50%, #e0f2fe 100%);--dark-success:#34d399;--dark-warning:#fb923c;--dark-error:#f87171;--dark-info:#60a5fa;--light-success:#059669;--light-warning:#ea580c;--light-error:#dc2626;--light-info:#2563eb;--shadow-sm:0 1px 3px rgba(0, 0, 0, 0.08);--shadow-md:0 2px 8px rgba(0, 0, 0, 0.1);--shadow-lg:0 4px 12px rgba(0, 0, 0, 0.12);--shadow-primary-sm:0 2px 8px rgba(59, 130, 246, 0.12);--shadow-primary-lg:0 4px 16px rgba(59, 130, 246, 0.2);--shadow-focus:0 0 0 3px rgba(59, 130, 246, 0.15);--space-1:0.25rem;--space-2:0.5rem;--space-3:0.75rem;--space-4:1rem;--space-5:1.25rem;--space-6:1.5rem;--space-8:2rem;--radius-sm:4px;--radius-md:6px;--radius-lg:8px;--radius-full:9999px;--font-sans:-apple-system,BlinkMacSystemFont,'SF Pro Display','Segoe UI',Roboto,sans-serif;--font-mono:'SF Mono',Consolas,'Liberation Mono',Menlo,monospace;--duration-fast:150ms;--duration-normal:300ms}[data-theme=dark]{--bg-primary:var(--dark-bg-primary);--bg-secondary:var(--dark-bg-secondary);--bg-tertiary:var(--dark-bg-tertiary);--text-primary:var(--dark-text-primary);--text-secondary:var(--dark-text-secondary);--text-tertiary:var(--dark-text-tertiary);--border-color:var(--dark-border);--border-hover:var(--dark-border-hover);--success:var(--dark-success);--warning:var(--dark-warning);--error:var(--dark-error);--info:var(--dark-info)}[data-theme=light]{--bg-primary:var(--light-bg-primary);--bg-secondary:var(--light-bg-secondary);--bg-tertiary:var(--light-bg-tertiary);--text-primary:var(--light-text-primary);--text-secondary:var(--light-text-secondary);--text-tertiary:var(--light-text-tertiary);--border-color:var(--light-border);--border-hover:var(--light-border-hover);--success:var(--light-success);--warning:var(--light-warning);--error:var(--light-error);--info:var(--light-info)}*{margin:0;padding:0;box-sizing:border-box}body{font-family:var(--font-sans);background:var(--bg-primary);color:var(--text-primary);line-height:1.6;-webkit-font-smoothing:antialiased;min-height:100vh}.background-gradient{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none}[data-theme=dark] .background-gradient{background:var(--page-bg-dark),var(--dark-bg-primary)}[data-theme=light] .background-gradient{background:var(--page-bg-light)}.container{position:relative;z-index:1;max-width:1400px;margin:0 auto;padding:var(--space-6)}header{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-6);padding-bottom:var(--space-6);border-bottom:1px solid var(--border-color)}.header-left{display:flex;align-items:center;gap:var(--space-4)}h1{font-size:1.5rem;font-weight:600;letter-spacing:-.02em}.db-status{display:flex;align-items:center;gap:var(--space-2);font-size:.8125rem;color:var(--text-tertiary)}.status-dot{width:8px;height:8px;border-radius:50%;background:var(--warning);transition:background var(--duration-fast)}.status-dot.connected{background:var(--success)}.theme-toggle{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-full);padding:var(--space-2) var(--space-4);display:flex;align-items:center;gap:var(--space-2);cursor:pointer;transition:all var(--duration-normal);color:var(--text-secondary);font-size:.875rem}[data-theme=light] .theme-toggle{background:rgba(255,255,255,.7);backdrop-filter:blur(12px)}.theme-toggle:hover{border-color:var(--border-hover);color:var(--text-primary)}.theme-toggle svg{width:16px;height:16px;stroke:currentColor;stroke-width:2;fill:none}.controls{display:flex;gap:var(--space-3);margin-bottom:var(--space-6);flex-wrap:wrap;align-items:center}.btn{display:inline-flex;align-items:center;justify-content:center;gap:var(--space-2);padding:var(--space-2) var(--space-4);font-size:.875rem;font-weight:500;border-radius:var(--radius-md);border:1px solid var(--border-color);cursor:pointer;transition:all var(--duration-normal);font-family:var(--font-sans);background:var(--bg-secondary);color:var(--text-secondary)}[data-theme=light] .btn{background:rgba(255,255,255,.7);backdrop-filter:blur(10px)}.btn:hover:not(:disabled){border-color:var(--border-hover);color:var(--text-primary);transform:translateY(-1px)}.btn:disabled{opacity:.5;cursor:not-allowed}.btn-primary{background:var(--primary-blue);border-color:var(--primary-blue);color:#fff}.btn-primary:hover:not(:disabled){background:#2563eb;border-color:#2563eb;box-shadow:var(--shadow-primary-lg)}.btn svg{width:16px;height:16px;stroke:currentColor;stroke-width:2;fill:none}.file-input-wrapper{position:relative}.file-input-wrapper input[type=file]{position:absolute;opacity:0;width:100%;height:100%;cursor:pointer}.file-btn{display:inline-flex;align-items:center;gap:var(--space-2);padding:var(--space-2) var(--space-4);font-size:.875rem;font-weight:500;border-radius:var(--radius-md);border:1px solid var(--primary-blue);background:rgba(59,130,246,.1);color:var(--primary-blue);cursor:pointer;transition:all var(--duration-normal)}.file-btn:hover{background:var(--primary-blue);color:#fff}.table-tabs{display:flex;gap:var(--space-2);margin-bottom:var(--space-5);flex-wrap:wrap}.table-tab{background:var(--bg-secondary);border:1px solid var(--border-color);padding:var(--space-2) var(--space-4);border-radius:var(--radius-md);cursor:pointer;font-size:.875rem;color:var(--text-secondary);transition:all var(--duration-normal);display:flex;align-items:center;gap:var(--space-2)}[data-theme=light] .table-tab{background:rgba(255,255,255,.6)}.table-tab:hover{border-color:var(--border-hover);color:var(--text-primary)}.table-tab.active{background:var(--primary-blue);border-color:var(--primary-blue);color:#fff}.table-tab .count{background:rgba(255,255,255,.2);padding:2px 8px;border-radius:var(--radius-full);font-size:.75rem;font-weight:600}.table-tab:not(.active) .count{background:var(--bg-tertiary)}.glass-card{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-lg);padding:var(--space-5);position:relative;margin-bottom:var(--space-5)}[data-theme=dark] .glass-card{backdrop-filter:blur(24px)}[data-theme=light] .glass-card{background:rgba(255,255,255,.7);backdrop-filter:blur(20px);box-shadow:0 8px 32px rgba(59,130,246,.1)}.glass-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:var(--card-accent-gradient)}.filters{display:grid;grid-template-columns:1fr auto auto;gap:var(--space-4);align-items:end}@media (max-width:768px){.filters{grid-template-columns:1fr}}.filter-group{display:flex;flex-direction:column;gap:var(--space-2)}.filter-group label{font-size:.75rem;font-weight:600;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:.05em}.form-input,.form-select{width:100%;padding:var(--space-3) var(--space-4);background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);color:var(--text-primary);font-size:.9375rem;font-family:var(--font-sans);transition:all var(--duration-normal)}[data-theme=light] .form-input{background:rgba(255,255,255,.7);backdrop-filter:blur(12px)}.form-input:focus,.form-select:focus{outline:0;border-color:var(--primary-blue);box-shadow:var(--shadow-focus)}.form-input::placeholder{color:var(--text-tertiary)}.search-wrapper{position:relative}.search-wrapper .form-input{padding-left:2.5rem;padding-right:2.5rem}.search-icon{position:absolute;left:var(--space-3);top:50%;transform:translateY(-50%);width:16px;height:16px;stroke:var(--text-tertiary);stroke-width:2;fill:none;pointer-events:none}.clear-search{position:absolute;right:var(--space-2);top:50%;transform:translateY(-50%);background:0 0;border:none;color:var(--text-tertiary);cursor:pointer;padding:var(--space-1);border-radius:var(--radius-sm);display:none;line-height:1}.clear-search.visible{display:flex}.clear-search:hover{color:var(--text-primary);background:var(--bg-tertiary)}.search-terms{display:flex;gap:var(--space-2);flex-wrap:wrap;margin-top:var(--space-2)}.search-term{background:var(--primary-blue);color:#fff;padding:2px var(--space-2);border-radius:var(--radius-full);font-size:.75rem;display:flex;align-items:center;gap:var(--space-1)}.search-term .remove{cursor:pointer;opacity:.7;font-size:.875rem}.search-term .remove:hover{opacity:1}.form-select{appearance:none;background-repeat:no-repeat;background-position:right .75rem center;background-size:1.25em;padding-right:2.5rem;cursor:pointer}[data-theme=dark] .form-select{background-image:url('data:image/svg+xml;utf8,<svg fill="none" stroke="rgb(156, 163, 175)" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>')}[data-theme=light] .form-select{background-color:rgba(255,255,255,.7);backdrop-filter:blur(12px);background-image:url('data:image/svg+xml;utf8,<svg fill="none" stroke="rgb(75, 85, 99)" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>')}.tag-filters-section{margin-top:var(--space-4);padding-top:var(--space-4);border-top:1px solid var(--border-color)}.tag-filters{display:flex;gap:var(--space-2);flex-wrap:wrap}.tag-chip{background:var(--bg-tertiary);padding:var(--space-1) var(--space-3);border-radius:var(--radius-full);font-size:.75rem;cursor:pointer;border:1px solid transparent;transition:all var(--duration-fast);color:var(--text-secondary)}.tag-chip:hover{border-color:var(--border-hover);color:var(--text-primary)}.tag-chip.active{background:var(--primary-blue);color:#fff}.tag-chip.system{border-left:3px solid var(--primary-blue)}.tag-chip.agent{border-left:3px solid var(--accent-green)}.results-info{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-3);font-size:.8125rem;color:var(--text-tertiary)}.table-container{overflow-x:auto;border:1px solid var(--border-color);border-radius:var(--radius-lg);background:var(--bg-secondary);position:relative}.table-container::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:var(--card-accent-gradient);z-index:1}[data-theme=light] .table-container{background:rgba(255,255,255,.6);backdrop-filter:blur(16px);box-shadow:0 8px 32px rgba(59,130,246,.1)}table{width:100%;border-collapse:collapse;font-size:.8125rem}thead{background:var(--bg-secondary)}[data-theme=light] thead{background:rgba(255,255,255,.4)}th{text-align:left;padding:var(--space-2) var(--space-3);font-weight:600;color:var(--text-primary);font-size:.6875rem;text-transform:uppercase;letter-spacing:.05em;cursor:pointer;white-space:nowrap;position:sticky;top:0;background:inherit;transition:background var(--duration-fast)}th:hover{background:var(--bg-tertiary)}th .sort-indicator{margin-left:var(--space-1);opacity:.4}td{padding:var(--space-2) var(--space-3);color:var(--text-secondary);border-top:1px solid var(--border-color);max-width:300px;font-size:.8125rem;line-height:1.4}tbody tr{transition:background var(--duration-fast)}tbody tr:hover{background:var(--bg-secondary)}[data-theme=light] tbody tr:hover{background:rgba(59,130,246,.06)}.cell-tags{display:flex;gap:3px;flex-wrap:wrap}.cell-tag{background:var(--bg-tertiary);padding:1px 6px;border-radius:3px;font-size:.625rem;font-family:var(--font-mono);white-space:nowrap}.cell-tag.system{color:var(--primary-blue)}.cell-tag.agent{color:var(--accent-green)}.cell-content{max-height:100px;overflow:hidden;cursor:pointer}.query-section{margin-bottom:var(--space-5)}.query-section textarea{width:100%;min-height:80px;padding:var(--space-4);background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);color:var(--text-primary);font-family:var(--font-mono);font-size:.875rem;resize:vertical;transition:all var(--duration-normal)}[data-theme=light] .query-section textarea{background:rgba(255,255,255,.7)}.query-section textarea:focus{outline:0;border-color:var(--primary-blue);box-shadow:var(--shadow-focus)}.query-actions{display:flex;gap:var(--space-2);margin-top:var(--space-3)}.empty-state{text-align:center;padding:var(--space-8);color:var(--text-tertiary)}.empty-state h2{font-size:1.25rem;margin-bottom:var(--space-2);color:var(--text-secondary)}.empty-state p{font-size:.9375rem}.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);z-index:1000;padding:var(--space-8);overflow-y:auto;backdrop-filter:blur(4px)}.modal.active{display:flex;align-items:flex-start;justify-content:center}.modal-content{background:var(--bg-primary);border:1px solid var(--border-color);border-radius:var(--radius-lg);max-width:800px;width:100%;margin-top:var(--space-8);position:relative}[data-theme=light] .modal-content{background:#fff;box-shadow:0 24px 48px rgba(0,0,0,.2)}.modal-content::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--primary-gradient);border-radius:var(--radius-lg) var(--radius-lg) 0 0}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:var(--space-5);border-bottom:1px solid var(--border-color)}.modal-header h3{font-size:1.125rem;font-weight:600}.modal-close{background:0 0;border:none;color:var(--text-tertiary);font-size:1.5rem;cursor:pointer;padding:var(--space-1);line-height:1}.modal-close:hover{color:var(--text-primary)}.modal-body{padding:var(--space-5)}.modal-body pre{background:var(--bg-secondary);padding:var(--space-4);border-radius:var(--radius-md);overflow-x:auto;white-space:pre-wrap;word-break:break-word;font-family:var(--font-mono);font-size:.875rem;line-height:1.6}.markdown-content{font-size:.9375rem;line-height:1.7;color:var(--text-primary)}.markdown-content h1,.markdown-content h2,.markdown-content h3,.markdown-content h4{margin-top:var(--space-6);margin-bottom:var(--space-3);font-weight:600;color:var(--text-primary)}.markdown-content h1{font-size:1.5rem;border-bottom:1px solid var(--border-color);padding-bottom:var(--space-2)}.markdown-content h2{font-size:1.25rem;border-bottom:1px solid var(--border-color);padding-bottom:var(--space-2)}.markdown-content h3{font-size:1.125rem}.markdown-content h4{font-size:1rem}.markdown-content p{margin-bottom:var(--space-4)}.markdown-content ol,.markdown-content ul{margin-bottom:var(--space-4);padding-left:var(--space-6)}.markdown-content li{margin-bottom:var(--space-2)}.markdown-content code{background:var(--bg-tertiary);padding:.2em .4em;border-radius:var(--radius-sm);font-family:var(--font-mono);font-size:.875em;color:var(--primary-blue)}.markdown-content pre{margin-bottom:var(--space-4)}.markdown-content pre code{background:0 0;padding:0;color:inherit}.markdown-content table{width:100%;margin-bottom:var(--space-4);border-collapse:collapse;font-size:.875rem}.markdown-content td,.markdown-content th{padding:var(--space-2) var(--space-3);border:1px solid var(--border-color);text-align:left}.markdown-content th{background:var(--bg-tertiary);font-weight:600}.markdown-content blockquote{margin:var(--space-4) 0;padding:var(--space-3) var(--space-4);border-left:4px solid var(--primary-blue);background:var(--bg-secondary);color:var(--text-secondary)}.markdown-content a{color:var(--primary-blue);text-decoration:none}.markdown-content a:hover{text-decoration:underline}.markdown-content hr{border:none;border-top:1px solid var(--border-color);margin:var(--space-6) 0}.markdown-content strong{font-weight:600;color:var(--text-primary)}.view-toggle{display:flex;gap:var(--space-2);margin-bottom:var(--space-4);padding-bottom:var(--space-3);border-bottom:1px solid var(--border-color)}.view-toggle button{padding:var(--space-2) var(--space-4);background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md);color:var(--text-secondary);cursor:pointer;font-size:.8125rem;transition:all var(--duration-fast)}.view-toggle button.active{background:var(--primary-gradient);border-color:transparent;color:#fff}.view-toggle button:hover:not(.active){background:var(--bg-tertiary);color:var(--text-primary)}.field-section{margin-bottom:var(--space-5)}.field-label{font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;color:var(--text-tertiary);margin-bottom:var(--space-2)}.field-value{color:var(--text-primary)}.field-value.raw{font-family:var(--font-mono);font-size:.875rem;background:var(--bg-secondary);padding:var(--space-3);border-radius:var(--radius-md);white-space:pre-wrap;word-break:break-word}.file-browser{display:none;margin-top:var(--space-4)}.file-browser.active{display:block}.file-breadcrumbs{display:flex;align-items:center;gap:var(--space-1);padding:var(--space-3) var(--space-4);background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-md) var(--radius-md) 0 0;font-size:.875rem;overflow-x:auto;white-space:nowrap}.breadcrumb-item{display:flex;align-items:center;gap:var(--space-1)}.breadcrumb-link{color:var(--primary-blue);text-decoration:none;cursor:pointer;padding:var(--space-1) var(--space-2);border-radius:var(--radius-sm);transition:background var(--duration-fast)}.breadcrumb-link:hover{background:var(--bg-tertiary);text-decoration:underline}.breadcrumb-separator{color:var(--text-tertiary);font-size:.75rem}.breadcrumb-current{color:var(--text-primary);font-weight:500}.breadcrumb-repo-icon{width:16px;height:16px;color:var(--text-secondary);flex-shrink:0}.file-table-container{border:1px solid var(--border-color);border-top:none;border-radius:0 0 var(--radius-md) var(--radius-md);overflow:hidden}.file-table{width:100%;border-collapse:collapse;font-size:.875rem}.file-table th{background:var(--bg-secondary);padding:var(--space-3) var(--space-4);text-align:left;font-weight:500;color:var(--text-secondary);border-bottom:1px solid var(--border-color)}.file-table td{padding:var(--space-3) var(--space-4);border-bottom:1px solid var(--border-color);vertical-align:middle}.file-table tr:last-child td{border-bottom:none}.file-table tbody tr{cursor:pointer;transition:background var(--duration-fast)}.file-table tbody tr:hover{background:var(--bg-tertiary)}.file-name-cell{display:flex;align-items:center;gap:var(--space-3)}.file-icon{width:16px;height:16px;flex-shrink:0}.file-icon.folder{color:var(--primary-blue)}.file-icon.markdown{color:var(--text-secondary)}.file-icon.file{color:var(--text-tertiary)}.file-name{color:var(--text-primary)}.file-name:hover{color:var(--primary-blue);text-decoration:underline}.file-size{color:var(--text-tertiary);text-align:right;font-family:var(--font-mono);font-size:.75rem}.file-browser-loading{display:flex;align-items:center;justify-content:center;padding:var(--space-8);color:var(--text-secondary)}.file-browser-empty{text-align:center;padding:var(--space-8);color:var(--text-tertiary)}@media (max-width:768px){.container{padding:var(--space-4)}header{flex-direction:column;gap:var(--space-4);align-items:flex-start}.controls{flex-direction:column;align-items:stretch}.filters{grid-template-columns:1fr}td,th{padding:var(--space-3)}}</style></head><body><div class="background-gradient"></div><div class="container"><header><div class="header-left"><h1>Worklog Viewer</h1><div class="db-status"><span class="status-dot" id="statusDot"></span> <span id="statusText">No database loaded</span></div></div><button class="theme-toggle" id="themeToggle"><svg id="sunIcon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg> <svg id="moonIcon" style="display:none" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg> <span id="themeLabel">Light</span></button></header><div class="controls"><div class="file-input-wrapper"><input type="file" id="dbFile" accept=".db,.sqlite,.sqlite3"> <span class="file-btn"><svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg> Load Database</span></div><button class="btn" id="refreshBtn" disabled="disabled"><svg viewBox="0 0 24 24"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg> Refresh</button> <button class="btn" id="exportBtn" disabled="disabled"><svg viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg> Export CSV</button></div><div class="query-section glass-card"><textarea id="customQuery" placeholder="Enter custom SQL query... (e.g., SELECT * FROM entries WHERE tags LIKE '%ollama%')"></textarea><div class="query-actions"><button class="btn btn-primary" id="runQueryBtn" disabled="disabled">Run Query</button> <button class="btn" id="clearQueryBtn">Clear</button></div></div><div class="glass-card" id="docViewerSection"><div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--space-4)"><div style="display:flex;align-items:center;gap:var(--space-3)"><label style="font-size:.75rem;font-weight:600;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:.05em">Fetch Document</label> <select id="docBranch" class="form-select" style="width:auto;min-width:140px"></select></div><button class="btn" id="docSettingsBtn" style="padding:var(--space-2);background:0 0;border:1px solid var(--border-color)" title="Settings"><svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></button></div><div style="display:flex;gap:var(--space-3)"><div class="search-wrapper" style="flex:1"><svg class="search-icon" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg> <input id="docPath" class="form-input" placeholder="docs/ubuntu-mini-guide.md" style="padding-left:2.5rem"></div><button class="btn btn-primary" id="fetchDocBtn"><svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg> Fetch</button> <button class="btn" id="browseDocsBtn"><svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg> Browse</button> <button class="btn" id="setTokenBtn" style="display:inline-flex;align-items:center;gap:var(--space-2)"><svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg> <span id="tokenBtnText">Token</span></button></div><div id="docTokenNotice" style="margin-top:var(--space-3);padding:var(--space-3);background:var(--bg-tertiary);border-radius:var(--radius-md);font-size:.8125rem;color:var(--text-secondary);display:none"><strong>Tip:</strong> Set a GitHub token to access private repositories.</div><div class="file-browser" id="fileBrowser"><div class="file-breadcrumbs" id="fileBreadcrumbs"></div><div class="file-table-container"><table class="file-table"><thead><tr><th>Name</th><th style="width:100px;text-align:right">Size</th></tr></thead><tbody id="fileTableBody"></tbody></table></div></div></div><div class="table-tabs" id="tableTabs"></div><div class="glass-card" id="filtersSection" style="display:none"><div class="filters"><div class="filter-group"><label>Search</label><div class="search-wrapper"><svg class="search-icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg> <input id="searchInput" class="form-input" placeholder="Type terms to filter (e.g., mac-admin architecture)"> <button class="clear-search" id="clearSearch" title="Clear search"><svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div><div class="search-terms" id="searchTermsDisplay"></div></div><div class="filter-group"><label>Sort By</label> <select id="sortColumn" class="form-select"></select></div><div class="filter-group"><label>Order</label> <select id="sortOrder" class="form-select"><option value="DESC">Newest First</option><option value="ASC">Oldest First</option></select></div></div><div class="tag-filters-section"><label style="font-size:.75rem;font-weight:600;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:.05em;display:block;margin-bottom:var(--space-2)">Filter by Tags</label><div class="tag-filters" id="tagFilters"></div></div></div><div class="results-info" id="resultsInfo" style="display:none"><span id="rowCount"></span> <span id="lastUpdated"></span></div><div class="table-container" id="tableContainer"><div class="empty-state"><h2>No Database Loaded</h2><p>Click "Load Database" to open your worklog.db file</p><p style="margin-top:var(--space-2);font-size:.8125rem">Default: ~/.claude/worklog/worklog.db</p></div></div><footer style="text-align:center;padding:var(--space-4);margin-top:var(--space-4);font-size:.75rem;color:var(--text-tertiary)">Design by <a href="https://github.com/gaurangrshah" target="_blank" rel="noopener" style="color:var(--primary-blue);text-decoration:none">@gaurangrshah</a> · MIT License</footer></div><div class="modal" id="detailModal"><div class="modal-content"><div class="modal-header"><h3 id="modalTitle">Row Details</h3><button class="modal-close" id="modalClose">&times;</button></div><div class="modal-body" id="modalBody"></div></div></div><div class="modal" id="tokenModal"><div class="modal-content" style="max-width:480px"><div class="modal-header"><h3>GitHub Access Token</h3><button class="modal-close" id="tokenModalClose">&times;</button></div><div class="modal-body" style="padding:var(--space-6)"><p style="margin-bottom:var(--space-4);color:var(--text-secondary)">A Personal Access Token (PAT) is required to access private repositories.</p><div style="margin-bottom:var(--space-4)"><label for="tokenInput" style="display:block;margin-bottom:var(--space-2);font-weight:500">Token</label> <input type="password" id="tokenInput" class="form-input" placeholder="ghp_xxxxxxxxxxxx" style="width:100%"></div><div style="display:flex;gap:var(--space-3);align-items:center;flex-wrap:wrap"><button class="btn btn-primary" id="saveTokenBtn">Save Token</button> <button class="btn" id="clearTokenBtn" style="background:0 0;border:1px solid var(--border-color)">Clear Token</button> <a href="https://github.com/settings/tokens/new?scopes=repo&description=Worklog%20Viewer" target="_blank" rel="noopener" class="btn" style="background:0 0;border:1px solid var(--border-color);text-decoration:none;display:inline-flex;align-items:center;gap:var(--space-2)"><svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg> Create Token on GitHub</a></div><p style="margin-top:var(--space-4);font-size:.8125rem;color:var(--text-tertiary)">Token is stored in your browser's localStorage and never sent anywhere except GitHub's API.</p></div></div></div><div class="modal" id="settingsModal"><div class="modal-content" style="max-width:480px"><div class="modal-header"><h3>Document Viewer Settings</h3><button class="modal-close" id="settingsModalClose">&times;</button></div><div class="modal-body" style="padding:var(--space-6)"><div style="margin-bottom:var(--space-4)"><label for="repoInput" style="display:block;margin-bottom:var(--space-2);font-weight:500">GitHub Repository</label> <input id="repoInput" class="form-input" placeholder="owner/repo" style="width:100%"><p style="margin-top:var(--space-1);font-size:.75rem;color:var(--text-tertiary)">Format: owner/repo (e.g., gaurangrshah/atlas-docs)</p></div><div style="margin-bottom:var(--space-4)"><label for="branchesInput" style="display:block;margin-bottom:var(--space-2);font-weight:500">Branches</label> <input id="branchesInput" class="form-input" placeholder="main, develop, feature-x" style="width:100%"><p style="margin-top:var(--space-1);font-size:.75rem;color:var(--text-tertiary)">Comma-separated list of branches to show in dropdown</p></div><div style="display:flex;gap:var(--space-3)"><button class="btn btn-primary" id="saveSettingsBtn">Save Settings</button> <button class="btn" id="resetSettingsBtn" style="background:0 0;border:1px solid var(--border-color)">Reset to Default</button></div></div></div></div><script>let db=null,tables=[],currentTable=null,currentData=[],allTags=new Set,activeTagFilters=new Set,SQL=null,cachedDbName=null;const DB_CACHE_NAME="worklog-viewer-cache",DB_CACHE_STORE="databases";async function openCacheDB(){return new Promise((e,t)=>{const n=indexedDB.open(DB_CACHE_NAME,1);n.onerror=()=>t(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("databases")||t.createObjectStore("databases")}})}async function cacheDatabase(e,t){const n=await openCacheDB();return new Promise((a,o)=>{const c=n.transaction("databases","readwrite");c.objectStore("databases").put({name:e,data:t,timestamp:Date.now()},"current"),c.oncomplete=()=>{localStorage.setItem("worklog-db-name",e),a()},c.onerror=()=>o(c.error)})}async function loadCachedDatabase(){try{const e=await openCacheDB();return new Promise((t,n)=>{const a=e.transaction("databases","readonly").objectStore("databases").get("current");a.onsuccess=()=>t(a.result),a.onerror=()=>n(a.error)})}catch{return null}}const themeToggle=document.getElementById("themeToggle"),sunIcon=document.getElementById("sunIcon"),moonIcon=document.getElementById("moonIcon"),themeLabel=document.getElementById("themeLabel");function setTheme(e){document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),"dark"===e?(sunIcon.style.display="block",moonIcon.style.display="none",themeLabel.textContent="Light"):(sunIcon.style.display="none",moonIcon.style.display="block",themeLabel.textContent="Dark")}themeToggle.addEventListener("click",()=>{setTheme("dark"===document.documentElement.getAttribute("data-theme")?"light":"dark")});const savedTheme=localStorage.getItem("theme")||"dark";setTheme(savedTheme);const savedBranch=localStorage.getItem("worklog-doc-branch");if(savedBranch){const e=document.getElementById("docBranch");e.querySelector(`option[value="${savedBranch}"]`)&&(e.value=savedBranch)}async function initDatabase(){try{SQL=await initSqlJs({locateFile:e=>`https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${e}`});const e=await loadCachedDatabase();if(e&&e.data)return void await loadDatabaseFromData(e.data,e.name+" (cached)");updateStatus(!1,"Ready - load database")}catch(e){updateStatus(!1,"Error: "+e.message)}}async function loadDatabaseFromData(e,t){try{db=new SQL.Database(e);const n=db.exec("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' ORDER BY name");if(tables=n[0]?.values.map(e=>e[0])||[],cachedDbName=t,updateStatus(!0,t),renderTableTabs(),enableControls(),tables.length>0){const e=localStorage.getItem("worklog-current-table");e&&tables.includes(e)?selectTable(e):selectTable(tables[0])}}catch(e){updateStatus(!1,"Error: "+e.message)}}function updateStatus(e,t){document.getElementById("statusDot").className="status-dot"+(e?" connected":""),document.getElementById("statusText").textContent=t}function enableControls(){document.getElementById("refreshBtn").disabled=!1,document.getElementById("exportBtn").disabled=!1,document.getElementById("runQueryBtn").disabled=!1}function renderTableTabs(){const e=document.getElementById("tableTabs");e.innerHTML=tables.map(e=>`<div class="table-tab" data-table="${e}">${e}<span class="count">${db.exec(`SELECT COUNT(*) FROM ${e}`)[0]?.values[0][0]||0}</span></div>`).join(""),e.querySelectorAll(".table-tab").forEach(e=>{e.addEventListener("click",()=>selectTable(e.dataset.table))})}function selectTable(e){currentTable=e,localStorage.setItem("worklog-current-table",e),document.querySelectorAll(".table-tab").forEach(t=>{t.classList.toggle("active",t.dataset.table===e)});const t=getTableColumns(e);document.getElementById("sortColumn").innerHTML=t.map(e=>`<option value="${e}">${e}</option>`).join(""),extractTags(e),document.getElementById("filtersSection").style.display="block",loadTableData()}function getTableColumns(e){const t=db.exec(`PRAGMA table_info(${e})`);return t[0]?.values.map(e=>e[1])||[]}function extractTags(e){allTags.clear();if(getTableColumns(e).includes("tags")){const t=db.exec(`SELECT DISTINCT tags FROM ${e} WHERE tags IS NOT NULL`);t[0]?.values.forEach(e=>{(e[0]?.split(",")||[]).forEach(e=>{const t=e.trim();t&&allTags.add(t)})})}renderTagFilters()}function renderTagFilters(){const e=document.getElementById("tagFilters"),t=Array.from(allTags).sort((e,t)=>{const n=e.startsWith("system:")?0:e.startsWith("agent:")?1:2,a=t.startsWith("system:")?0:t.startsWith("agent:")?1:2;return n!==a?n-a:e.localeCompare(t)});e.innerHTML=t.map(e=>{const t=["tag-chip"];return e.startsWith("system:")&&t.push("system"),e.startsWith("agent:")&&t.push("agent"),activeTagFilters.has(e)&&t.push("active"),`<span class="${t.join(" ")}" data-tag="${e}">${e}</span>`}).join(""),e.querySelectorAll(".tag-chip").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tag;activeTagFilters.has(t)?activeTagFilters.delete(t):activeTagFilters.add(t),renderTagFilters(),loadTableData()})})}function loadTableData(){if(!currentTable)return;const e=getTableColumns(currentTable),t=document.getElementById("sortColumn").value||e[0],n=document.getElementById("sortOrder").value,a=document.getElementById("searchInput").value.trim().toLowerCase();let o=`SELECT * FROM ${currentTable}`;const c=[];if(activeTagFilters.size>0&&e.includes("tags")){const e=Array.from(activeTagFilters).map(e=>`tags LIKE '%${e.replace(/'/g,"''")}%'`);c.push(`(${e.join(" AND ")})`)}c.length>0&&(o+=` WHERE ${c.join(" AND ")}`),o+=` ORDER BY ${t} ${n}`;try{const t=db.exec(o);currentData=t[0]?.values||[];const n=t[0]?.columns||e;if(a){const e=a.split(/\s+/).filter(e=>e.length>0);currentData=currentData.filter(t=>{const n=t.map(e=>String(e).toLowerCase()).join(" ");return e.every(e=>n.includes(e))})}renderTable(n,currentData),updateResultsInfo()}catch(e){document.getElementById("tableContainer").innerHTML=`<div class="empty-state"><h2>Query Error</h2><p>${e.message}</p></div>`}}function renderTable(e,t){if(0===t.length)return void(document.getElementById("tableContainer").innerHTML='<div class="empty-state"><h2>No Results</h2><p>Try adjusting your filters</p></div>');const n=e.indexOf("tags");let a="<table><thead><tr>";e.forEach(e=>{a+=`<th data-col="${e}">${e}<span class="sort-indicator">↕</span></th>`}),a+="</tr></thead><tbody>",t.forEach((e,t)=>{a+=`<tr data-row="${t}">`,e.forEach((e,t)=>{if(t===n&&e){const t=e.split(",").map(e=>e.trim()).filter(e=>e);a+='<td><div class="cell-tags">',t.forEach(e=>{let t="cell-tag";e.startsWith("system:")&&(t+=" system"),e.startsWith("agent:")&&(t+=" agent"),a+=`<span class="${t}">${e}</span>`}),a+="</div></td>"}else String(e).length>100?a+=`<td><div class="cell-content" title="Double-click to expand">${escapeHtml(String(e).substring(0,100))}...</div></td>`:a+=`<td>${escapeHtml(String(e??""))}</td>`}),a+="</tr>"}),a+="</tbody></table>",document.getElementById("tableContainer").innerHTML=a,document.querySelectorAll("tr[data-row]").forEach(n=>{n.addEventListener("dblclick",()=>{const a=parseInt(n.dataset.row);showRowDetail(e,t[a])})}),document.querySelectorAll("th[data-col]").forEach(e=>{e.addEventListener("click",()=>{document.getElementById("sortColumn").value=e.dataset.col,loadTableData()})})}function escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}document.getElementById("docBranch").addEventListener("change",e=>{const t=e.target.value;localStorage.setItem("worklog-doc-branch",t);const n=document.getElementById("fileBrowser");n&&n.classList.contains("active")&&document.getElementById("browseDocsBtn").click()}),initDatabase(),document.getElementById("dbFile").addEventListener("change",async e=>{const t=e.target.files[0];if(t){SQL||(updateStatus(!1,"Initializing..."),await initDatabase());try{const e=await t.arrayBuffer(),n=new Uint8Array(e);await cacheDatabase(t.name,n),await loadDatabaseFromData(n,t.name)}catch(e){updateStatus(!1,"Error: "+e.message)}}});const MARKDOWN_FIELDS=["content","details","description","resolution","summary","key_points","raw_content"];function sanitizeHtml(e){return DOMPurify.sanitize(e,{ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","p","br","ul","ol","li","strong","em","code","pre","blockquote","a","table","thead","tbody","tr","th","td","hr","span","div"],ALLOWED_ATTR:["href","class","id"]})}marked.setOptions({highlight:function(e,t){if(t&&hljs.getLanguage(t))try{return hljs.highlight(e,{language:t}).value}catch(e){}return hljs.highlightAuto(e).value},breaks:!0,gfm:!0});let currentViewMode="rendered";function showRowDetail(e,t){const n=document.getElementById("detailModal"),a=document.getElementById("modalBody"),o=e.findIndex(e=>MARKDOWN_FIELDS.includes(e.toLowerCase())),c=-1!==o&&t[o];if(a.textContent="",c){const n=document.createElement("div");n.className="view-toggle";const o=document.createElement("button");o.id="viewRendered",o.textContent="Rendered",o.className="rendered"===currentViewMode?"active":"";const c=document.createElement("button");c.id="viewRaw",c.textContent="Raw",c.className="raw"===currentViewMode?"active":"",n.appendChild(o),n.appendChild(c),a.appendChild(n),o.addEventListener("click",()=>{currentViewMode="rendered",showRowDetail(e,t)}),c.addEventListener("click",()=>{currentViewMode="raw",showRowDetail(e,t)})}if(c&&"rendered"===currentViewMode)e.forEach((e,n)=>{const o=t[n],c=MARKDOWN_FIELDS.includes(e.toLowerCase()),l=document.createElement("div");l.className="field-section";const s=document.createElement("div");s.className="field-label",s.textContent=e,l.appendChild(s);const r=document.createElement("div");if(r.className="field-value",c&&o){r.classList.add("markdown-content");const e=sanitizeHtml(marked.parse(String(o)));r.innerHTML=e}else null==o?(r.style.color="var(--text-tertiary)",r.style.fontStyle="italic",r.textContent="NULL"):String(o).length>200?(r.classList.add("raw"),r.textContent=String(o)):r.textContent=String(o);l.appendChild(r),a.appendChild(l)}),a.querySelectorAll("pre code").forEach(e=>{hljs.highlightElement(e)});else{const n=document.createElement("pre");e.forEach((e,a)=>{const o=document.createElement("strong");o.textContent=e+":",n.appendChild(o),n.appendChild(document.createTextNode("\n"+(t[a]??"NULL")+"\n\n"))}),a.appendChild(n)}n.classList.add("active")}function updateResultsInfo(){document.getElementById("resultsInfo").style.display="flex",document.getElementById("rowCount").textContent=`${currentData.length} rows`,document.getElementById("lastUpdated").textContent=`Updated: ${(new Date).toLocaleTimeString()}`}function updateSearchUI(){const e=document.getElementById("searchInput"),t=document.getElementById("clearSearch"),n=document.getElementById("searchTermsDisplay"),a=e.value.trim();a?t.classList.add("visible"):t.classList.remove("visible");const o=a.split(/\s+/).filter(e=>e.length>0);o.length>0?(n.innerHTML=o.map(e=>`<span class="search-term">${escapeHtml(e)}<span class="remove" data-term="${escapeHtml(e)}">&times;</span></span>`).join(""),n.querySelectorAll(".remove").forEach(t=>{t.addEventListener("click",()=>{const n=t.dataset.term,a=e.value.split(/\s+/).filter(e=>e.length>0);e.value=a.filter(e=>e!==n).join(" "),updateSearchUI(),loadTableData()})})):n.innerHTML=""}function debounce(e,t){let n;return(...a)=>{clearTimeout(n),n=setTimeout(()=>e(...a),t)}}document.getElementById("clearSearch").addEventListener("click",()=>{document.getElementById("searchInput").value="",updateSearchUI(),loadTableData()}),document.getElementById("searchInput").addEventListener("input",debounce(()=>{updateSearchUI(),loadTableData()},300)),document.getElementById("sortColumn").addEventListener("change",loadTableData),document.getElementById("sortOrder").addEventListener("change",loadTableData),document.getElementById("refreshBtn").addEventListener("click",loadTableData),document.getElementById("modalClose").addEventListener("click",()=>{document.getElementById("detailModal").classList.remove("active")}),document.getElementById("detailModal").addEventListener("click",e=>{"detailModal"===e.target.id&&document.getElementById("detailModal").classList.remove("active")}),document.getElementById("runQueryBtn").addEventListener("click",()=>{const e=document.getElementById("customQuery").value.trim();if(e)try{const t=db.exec(e);t.length>0?(currentData=t[0].values,renderTable(t[0].columns,currentData),updateResultsInfo()):document.getElementById("tableContainer").innerHTML='<div class="empty-state"><h2>Query executed</h2><p>No results returned</p></div>'}catch(e){document.getElementById("tableContainer").innerHTML=`<div class="empty-state"><h2>Query Error</h2><p>${e.message}</p></div>`}}),document.getElementById("clearQueryBtn").addEventListener("click",()=>{document.getElementById("customQuery").value="",currentTable&&loadTableData()}),document.getElementById("exportBtn").addEventListener("click",()=>{if(0===currentData.length)return;let e=getTableColumns(currentTable).join(",")+"\n";currentData.forEach(t=>{e+=t.map(e=>`"${String(e??"").replace(/"/g,'""')}"`).join(",")+"\n"});const t=new Blob([e],{type:"text/csv"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=`${currentTable}_export_${Date.now()}.csv`,a.click(),URL.revokeObjectURL(n)}),document.addEventListener("keydown",e=>{"Escape"===e.key&&document.getElementById("detailModal").classList.remove("active"),"Enter"===e.key&&e.ctrlKey&&document.getElementById("runQueryBtn").click()});const DEFAULT_GITHUB_REPO="gaurangrshah/atlas-docs",DEFAULT_BRANCHES=["main"];let githubRepo=localStorage.getItem("worklog-github-repo")||DEFAULT_GITHUB_REPO,branches=JSON.parse(localStorage.getItem("worklog-branches")||"null")||DEFAULT_BRANCHES,githubToken=localStorage.getItem("github-token")||"";function populateBranchDropdown(){const e=document.getElementById("docBranch"),t=e.value;for(;e.firstChild;)e.removeChild(e.firstChild);branches.forEach(t=>{const n=document.createElement("option");n.value=t.trim(),n.textContent=t.trim(),e.appendChild(n)}),branches.includes(t)&&(e.value=t)}populateBranchDropdown();const GITHUB_REPO=githubRepo,tokenModal=document.getElementById("tokenModal"),tokenInput=document.getElementById("tokenInput"),tokenBtnText=document.getElementById("tokenBtnText");function updateTokenBtnState(){githubToken?(tokenBtnText.textContent="Token ✓",document.getElementById("setTokenBtn").style.borderColor="var(--accent-green)",document.getElementById("docTokenNotice").style.display="none"):(tokenBtnText.textContent="Token",document.getElementById("setTokenBtn").style.borderColor="",document.getElementById("docTokenNotice").style.display="block")}updateTokenBtnState(),document.getElementById("setTokenBtn")?.addEventListener("click",()=>{tokenInput.value=githubToken||"",tokenModal.classList.add("active"),tokenInput.focus()}),document.getElementById("tokenModalClose")?.addEventListener("click",()=>{tokenModal.classList.remove("active")}),tokenModal?.addEventListener("click",e=>{e.target===tokenModal&&tokenModal.classList.remove("active")}),document.getElementById("saveTokenBtn")?.addEventListener("click",()=>{const e=tokenInput.value.trim();e&&(githubToken=e,localStorage.setItem("github-token",e),tokenModal.classList.remove("active"),updateTokenBtnState())}),document.getElementById("clearTokenBtn")?.addEventListener("click",()=>{githubToken="",localStorage.removeItem("github-token"),tokenInput.value="",tokenModal.classList.remove("active"),updateTokenBtnState()}),tokenInput?.addEventListener("keydown",e=>{"Enter"===e.key&&document.getElementById("saveTokenBtn").click(),"Escape"===e.key&&tokenModal.classList.remove("active")});const settingsModal=document.getElementById("settingsModal"),repoInput=document.getElementById("repoInput"),branchesInput=document.getElementById("branchesInput");async function fetchDocument(e,t){const n=`https://api.github.com/repos/${GITHUB_REPO}/contents/${e}?ref=${t}`,a={Accept:"application/vnd.github.v3.raw"};githubToken&&(a.Authorization=`token ${githubToken}`);try{const o=await fetch(n,{headers:a});if(!o.ok){if(404===o.status)throw new Error(`Document not found: ${e} on branch ${t}`);if(401===o.status||403===o.status)throw document.getElementById("docTokenNotice").style.display="block",new Error("Authentication required. Please set a GitHub token.");throw new Error(`Failed to fetch: ${o.status} ${o.statusText}`)}return await o.text()}catch(e){throw e}}function showDocumentModal(e,t,n){const a=document.getElementById("detailModal"),o=document.getElementById("modalTitle"),c=document.getElementById("modalBody");o.textContent=e.split("/").pop(),c.textContent="";const l=document.createElement("div");l.style.cssText="font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: var(--space-4); font-family: var(--font-mono);",l.textContent=`${n}/${e}`,c.appendChild(l);const s=document.createElement("div");s.className="view-toggle";const r=document.createElement("button");r.textContent="Rendered",r.className="active";const d=document.createElement("button");d.textContent="Raw",s.appendChild(r),s.appendChild(d),c.appendChild(s);const i=document.createElement("div");function m(){r.className="active",d.className="",i.className="markdown-content";const e=marked.parse(t);i.innerHTML=sanitizeHtml(e),i.querySelectorAll("pre code").forEach(e=>{hljs.highlightElement(e)})}i.id="docContent",c.appendChild(i),r.addEventListener("click",m),d.addEventListener("click",function(){r.className="",d.className="active",i.className="";const e=document.createElement("pre");e.style.cssText="background: var(--bg-secondary); padding: var(--space-4); border-radius: var(--radius-md); overflow-x: auto; white-space: pre-wrap;",e.textContent=t,i.textContent="",i.appendChild(e)}),m(),a.classList.add("active")}document.getElementById("docSettingsBtn")?.addEventListener("click",()=>{repoInput.value=githubRepo,branchesInput.value=branches.join(", "),settingsModal.classList.add("active"),repoInput.focus()}),document.getElementById("settingsModalClose")?.addEventListener("click",()=>{settingsModal.classList.remove("active")}),settingsModal?.addEventListener("click",e=>{e.target===settingsModal&&settingsModal.classList.remove("active")}),document.getElementById("saveSettingsBtn")?.addEventListener("click",()=>{const e=repoInput.value.trim(),t=branchesInput.value.split(",").map(e=>e.trim()).filter(e=>e);e&&t.length>0&&(githubRepo=e,branches=t,localStorage.setItem("worklog-github-repo",githubRepo),localStorage.setItem("worklog-branches",JSON.stringify(branches)),populateBranchDropdown(),settingsModal.classList.remove("active"),e!==GITHUB_REPO&&location.reload())}),document.getElementById("resetSettingsBtn")?.addEventListener("click",()=>{localStorage.removeItem("worklog-github-repo"),localStorage.removeItem("worklog-branches"),repoInput.value=DEFAULT_GITHUB_REPO,branchesInput.value=DEFAULT_BRANCHES.join(", ")}),document.getElementById("fetchDocBtn").addEventListener("click",async()=>{const e=document.getElementById("docPath").value.trim(),t=document.getElementById("docBranch").value;if(!e)return void alert("Please enter a document path");const n=document.getElementById("fetchDocBtn"),a=n.innerHTML;n.innerHTML="<span>Loading...</span>",n.disabled=!0;try{showDocumentModal(e,await fetchDocument(e,t),t)}catch(e){alert(e.message)}finally{n.innerHTML=a,n.disabled=!1}}),document.getElementById("browseDocsBtn").addEventListener("click",async()=>{const e=document.getElementById("docBranch").value,t=document.getElementById("docPath").value.trim()||"",n=document.getElementById("browseDocsBtn"),a=n.innerHTML;n.innerHTML="<span>Loading...</span>",n.disabled=!0;try{const n=`https://api.github.com/repos/${GITHUB_REPO}/contents/${t}?ref=${e}`,a={Accept:"application/vnd.github.v3+json"};githubToken&&(a.Authorization=`token ${githubToken}`);const o=await fetch(n,{headers:a});if(!o.ok){if(401===o.status||403===o.status)throw document.getElementById("docTokenNotice").style.display="block",new Error("Authentication required for private repos.");throw new Error(`Failed to browse: ${o.status}`)}showFileBrowser(await o.json(),t,e)}catch(e){alert(e.message)}finally{n.innerHTML=a,n.disabled=!1}});const FILE_ICONS={folder:'<svg class="file-icon folder" viewBox="0 0 24 24" fill="currentColor"><path d="M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>',markdown:'<svg class="file-icon markdown" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>',file:'<svg class="file-icon file" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>',repo:'<svg class="breadcrumb-repo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>'};function renderBreadcrumbs(e,t){const n=document.getElementById("fileBreadcrumbs");n.innerHTML="";const a=document.createElement("span");if(a.className="breadcrumb-item",a.innerHTML=`\n        ${FILE_ICONS.repo}\n        <span class="breadcrumb-link" data-path="">atlas-docs</span>\n      `,a.querySelector(".breadcrumb-link").addEventListener("click",()=>{navigateToPath("",t)}),n.appendChild(a),e){const a=e.split("/").filter(e=>e);let o="";a.forEach((e,c)=>{const l=document.createElement("span");l.className="breadcrumb-separator",l.textContent="/",n.appendChild(l),o+=(o?"/":"")+e;const s=c===a.length-1,r=document.createElement("span");if(r.className="breadcrumb-item",s)r.innerHTML=`<span class="breadcrumb-current">${e}</span>`;else{const n=o;r.innerHTML=`<span class="breadcrumb-link" data-path="${n}">${e}</span>`,r.querySelector(".breadcrumb-link").addEventListener("click",()=>{navigateToPath(n,t)})}n.appendChild(r)})}}function navigateToPath(e,t){document.getElementById("docPath").value=e,document.getElementById("browseDocsBtn").click()}function formatFileSize(e){if(0===e||void 0===e)return"-";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]}function getFileIcon(e){return"dir"===e.type?FILE_ICONS.folder:e.name.endsWith(".md")?FILE_ICONS.markdown:FILE_ICONS.file}function renderFileTable(e,t,n){const a=document.getElementById("fileTableBody"),o=document.getElementById("fileBrowser");a.innerHTML="";[...e].sort((e,t)=>"dir"===e.type&&"dir"!==t.type?-1:"dir"!==e.type&&"dir"===t.type?1:e.name.localeCompare(t.name)).forEach(e=>{const t=document.createElement("tr");t.className="file-row";const o="dir"===e.type||e.name.endsWith(".md");o&&(t.style.cursor="pointer");const c=document.createElement("td");c.className="file-name-cell",c.innerHTML=`\n          <span class="file-icon-wrapper">${getFileIcon(e)}</span>\n          <span class="file-name">${e.name}${"dir"===e.type?"/":""}</span>\n        `;const l=document.createElement("td");l.className="file-size-cell",l.textContent="dir"===e.type?"-":formatFileSize(e.size),t.appendChild(c),t.appendChild(l),o&&t.addEventListener("click",()=>{"dir"===e.type?navigateToPath(e.path,n):e.name.endsWith(".md")&&(document.getElementById("docPath").value=e.path,document.getElementById("fetchDocBtn").click())}),a.appendChild(t)}),o.classList.add("active"),renderBreadcrumbs(t,n)}function showFileBrowser(e,t,n){const a=document.getElementById("detailModal"),o=document.getElementById("modalTitle"),c=document.getElementById("modalBody");o.textContent=t||"Repository Root",c.textContent="";const l=document.createElement("div");if(l.style.cssText="font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: var(--space-4); font-family: var(--font-mono);",l.textContent=`Branch: ${n}`,c.appendChild(l),t){const e=document.createElement("button");e.className="btn",e.style.marginBottom="var(--space-3)",e.innerHTML="← Back",e.addEventListener("click",()=>{const e=t.split("/").slice(0,-1).join("/");document.getElementById("docPath").value=e,document.getElementById("browseDocsBtn").click()}),c.appendChild(e)}const s=document.createElement("div");s.style.cssText="display: flex; flex-direction: column; gap: var(--space-2);";[...e].sort((e,t)=>"dir"===e.type&&"dir"!==t.type?-1:"dir"!==e.type&&"dir"===t.type?1:e.name.localeCompare(t.name)).forEach(e=>{const t=document.createElement("div");t.style.cssText="display: flex; align-items: center; gap: var(--space-2); padding: var(--space-2) var(--space-3); background: var(--bg-secondary); border-radius: var(--radius-md); cursor: pointer; transition: background 0.15s;",t.addEventListener("mouseenter",()=>t.style.background="var(--bg-tertiary)"),t.addEventListener("mouseleave",()=>t.style.background="var(--bg-secondary)");const n=document.createElement("span");n.textContent="dir"===e.type?"📁":e.name.endsWith(".md")?"📄":"📋";const o=document.createElement("span");o.textContent=e.name,o.style.flex="1",t.appendChild(n),t.appendChild(o),t.addEventListener("click",()=>{"dir"===e.type?(document.getElementById("docPath").value=e.path,a.classList.remove("active"),setTimeout(()=>document.getElementById("browseDocsBtn").click(),100)):e.name.endsWith(".md")&&(document.getElementById("docPath").value=e.path,a.classList.remove("active"),setTimeout(()=>document.getElementById("fetchDocBtn").click(),100))}),s.appendChild(t)}),c.appendChild(s),a.classList.add("active")}document.getElementById("docPath").addEventListener("keydown",e=>{"Enter"===e.key&&document.getElementById("fetchDocBtn").click()})</script></body></html>